name: Build 2026 Firework Kivy APK

# è§¦å‘æ¡ä»¶ï¼š1. æ¨é€åˆ°mainåˆ†æ”¯ 2. æ‰‹åŠ¨è§¦å‘ï¼ˆæ¨èæ‰‹åŠ¨è§¦å‘ï¼Œæ›´çµæ´»ï¼‰
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    # è¿è¡Œç¯å¢ƒï¼šGitHubå®˜æ–¹Ubuntu 22.04ï¼ˆä¸ä½ çš„ç¯å¢ƒå®Œå…¨ä¸€è‡´ï¼‰
    runs-on: ubuntu-22.04
    steps:
      # æ­¥éª¤1ï¼šæ‹‰å–ä»“åº“ä»£ç åˆ°GitHubæœåŠ¡å™¨
      - name: Checkout Repository Code
        uses: actions/checkout@v4

      # æ­¥éª¤2ï¼šå®‰è£…æ‰“åŒ…æ‰€éœ€ä¾èµ–ï¼ˆè¡¥å……32ä½ä¾èµ–ï¼Œè§£å†³build-tools/Aidlç¼ºå¤±ï¼‰
      - name: Install Build Dependencies
        run: |
          sudo apt update && sudo apt install -y \
          python3-pip python3-dev git zip unzip openjdk-17-jdk \
          libssl-dev libffi-dev libxml2-dev libxslt1-dev zlib1g-dev \
          lib32z1 lib32stdc++6  # ğŸ”¥ è¡¥å……ï¼š32ä½è¿è¡Œä¾èµ–ï¼Œæ”¯æŒandroid build-tools
          python3 -m pip install --upgrade pip setuptools virtualenv
          pip3 install --upgrade buildozer cython==0.29.36 pillow

      # æ­¥éª¤3ï¼šä½¿ç”¨Buildozeræ„å»ºAndroid APKï¼ˆå…ˆæ¸…ç†æŸåç¼“å­˜ï¼Œå†æ‰“åŒ…ï¼Œè§£å†³SDKç¼“å­˜é—®é¢˜ï¼‰
      - name: Build APK with Buildozer
        run: |
          buildozer android clean  # ğŸ”¥ è¡¥å……ï¼šæ¸…ç†ä¹‹å‰æŸåçš„å®‰å“SDK/ç¼“å­˜
          buildozer android debug --no-clean

      # æ­¥éª¤4ï¼šä¸Šä¼ APKä½œä¸ºArtifactï¼ˆä»…ä¸Šä¼ çº¯å‡€APKï¼Œæ–¹ä¾¿ä½ ä¸‹è½½ï¼‰
      - name: Upload Finished APK
        uses: actions/upload-artifact@v4
        with:
          name: 2026-Firework-APK
          path: bin/*.apk
