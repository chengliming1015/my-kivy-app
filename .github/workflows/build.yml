name: Build 2026 Firework Kivy APK

# 触发条件：1. 推送到main分支 2. 手动触发（推荐手动触发，更灵活）
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    # 运行环境：GitHub官方Ubuntu 22.04（与你的环境完全一致）
    runs-on: ubuntu-22.04
    steps:
      # 步骤1：拉取仓库代码到GitHub服务器
      - name: Checkout Repository Code
        uses: actions/checkout@v4

      # 步骤2：安装打包所需依赖（自动安装，无需手动干预）
      - name: Install Build Dependencies
        run: |
          sudo apt update && sudo apt install -y \
          python3-pip python3-dev git zip unzip openjdk-17-jdk \
          libssl-dev libffi-dev libxml2-dev libxslt1-dev zlib1g-dev
          python3 -m pip install --upgrade pip setuptools virtualenv
          pip3 install --upgrade buildozer cython==0.29.36 pillow

      # 步骤3：使用Buildozer构建Android APK（自动处理500M缓存，不残留）
      - name: Build APK with Buildozer
        run: |
          buildozer android debug --no-clean

      # 步骤4：上传APK作为Artifact（仅上传纯净APK，方便你下载）
      - name: Upload Finished APK
        uses: actions/upload-artifact@v4
        with:
          name: 2026-Firework-APK
          path: bin/*.apk
